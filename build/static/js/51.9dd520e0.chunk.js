(this["webpackJsonpmy-app-2"]=this["webpackJsonpmy-app-2"]||[]).push([[51],{278:function(e,t,n){},280:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=280},338:function(e,t,n){"use strict";n.r(t);var r,a,c,o,u,i=n(127),s=n(18),l=n.n(s),d=n(36),m=n(26),p=(n(278),n(7)),f=n(279),b=n.n(f),v=n(0),h=n.n(v),g=n(120),y=n(197),E=n(142),O=n(83),S=n(101),w=n(354),j=n(136),k=n(100),x=n(40),N=n(308),q=n(133),I=n(170),R=n(22),C=n(173),F=n(348),D=n(3),U=n(44),T=Object(p.a)((function(){return Promise.all([n.e(4),n.e(66)]).then(n.bind(null,210))}),{fallback:h.a.createElement("i",{className:"fas fa-spinner fa-9x fa-spin"})}),V=I.d.socket,L={},M={host:"web-rtc-myanimefun.herokuapp.com",secure:!0,path:"/",config:{iceServers:[{url:"stun:stun01.sipphone.com"},{url:"stun:stun.ekiga.net"},{url:"stun:stunserver.org"},{url:"stun:stun.softjoys.com"},{url:"stun:stun.voiparound.com"},{url:"stun:stun.voipbuster.com"},{url:"stun:stun.voipstunt.com"},{url:"stun:stun.voxgratia.org"},{url:"stun:stun.xten.com"},{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"},{url:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]}},B=new y.a(3);function P(e,t,n,r){U.a.updateIsShowBlockPopUp(!0),I.d.updateData({isReconnect:!0,timePlayingVideo:r.currentTime,videoUrl:r.src,isVideoCall:t,isVideoWatchPlaying:!r.paused}),e.push("/theater"),setTimeout((function(){e.push("/theater/"+n),U.a.updateIsShowBlockPopUp(!1)}),1e3)}function z(e,t){return J.apply(this,arguments)}function J(){return(J=Object(d.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:V.emit("new-user",R.b.currentState().avatarImage,R.b.currentState().username,n,t,t);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){var t=e.usersOnline;return h.a.createElement("div",{className:"user-list-online"},h.a.createElement("div",{className:"title-room"},"Members Online"),t&&t.map((function(e,t){return h.a.createElement("div",{key:t},h.a.createElement("div",{style:{color:e.keepRemote?"red":"",margin:"0"}},e.username))})))}function A(e){return G.apply(this,arguments)}function G(){return(G=Object(d.a)(l.a.mark((function e(t){var n,r,a=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],r=a.length>2?a[2]:void 0,X(t,o,!0,r),Z(o),document.getElementById("button-get-remote").disabled=!0,e.next=7,Y(c,R.b.currentState().userId);case 7:V.emit("new-video",t,c,n,r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return H.apply(this,arguments)}function H(){return(H=Object(d.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/theater/".concat(t,"/members"),{method:"PUT",body:JSON.stringify({userId:n,keepRemote:!0}),headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(a)}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.querySelector(".video-watch");e&&e.childElementCount>0&&(e.addEventListener("pause",Q),e.addEventListener("play",K),e.addEventListener("ended",Q))}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.querySelector(".video-watch");e&&(e.controls=!1,e.removeEventListener("pause",Q),e.removeEventListener("play",K),e.removeEventListener("ended",Q))}function Q(){o||(o=document.querySelector(".video-watch")),V.emit("pause-all-video",o.currentTime,c)}function K(){o||(o=document.querySelector(".video-watch")),V.emit("play-all-video",o.currentTime,c)}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.querySelector(".video-watch"),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;try{if(e&&""!==e.trim()){t.controls=n,t.src=e;var a=t.querySelector("source");a||((a=document.createElement("source")).src=e,a.type="video/mp4",t.append(a)),a&&(a.src=e,a.type="video/mp4")}if(r&&""!==r.trim()){var c=t.querySelector("track");c||((c=document.createElement("track")).src=r.trim(),c.default=!0,t.append(c)),c&&(c.src=r.trim(),c.default=!0)}}catch(o){console.error(o)}}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.querySelector(".notification-user-join"),n=arguments.length>2?arguments[2]:void 0,r=document.createElement("div");r.innerText=e,r.style.wordWrap="break-word",n&&(r.className+=" ".concat(n)),t&&t.append(r)}function ee(e,t,n,r){n&&(e.id=r,e.srcObject=t,e.poster="https://www.kindpng.com/picc/m /24-248253_user-profile-default-image-png-clipart-png-download.png",e.addEventListener("loadedmetadata",(function(){e.play()})),e.addEventListener("click",(function(e){console.log(e.target),e.target.isMuted=!e.target.isMuted,e.target.className=e.target.isMuted?"video-muted":"",e.target.title=e.target.isMuted?"".concat(e.target.title.replace(/ muted/g,"")," muted"):"".concat(e.target.title.replace(/ muted/g,""))})),Object(i.a)(n.children).forEach((function(e){e.id===r&&e.remove()})),n.append(e),Object(i.a)(n.children).forEach((function(e){var t=I.d.currentState().usersOnline.find((function(t){return t.peerId===e.id}));t&&(e.poster=t.avatar,e.isControls=!0,e.title=t.username)})))}function te(){return(te=Object(d.a)(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/theater/".concat(t),{method:"GET",headers:{authorization:"Bearer ".concat(n)}});case 2:return r=e.sent,e.next=5,r.json();case 5:a=e.sent;try{Object(C.b)(!1),Object(C.f)(!0),I.d.updateData({currentRoomDetail:a.message})}catch(c){}case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}V.on("fetch-user-online",(function(){Object(I.b)(c,a).subscribe((function(e){I.d.updateData({usersOnline:e})}))})),V.on("mongo-change-watch",(function(){Object(I.b)(c,a).subscribe((function(e){I.d.updateData({usersOnline:e})}))})),V.on("play-video-user",(function(e,t){o||(o=document.querySelector(".video-watch")),t===c&&o&&o.childElementCount>0&&o.play().then((function(){o.currentTime=e})).catch((function(e){}))})),V.on("pause-video-user",(function(e,t){if(o||(o=document.querySelector(".video-watch")),t===c&&o){var n=o.play();n&&n.then((function(){o.pause(),o.currentTime=e})).catch((function(e){}))}})),V.on("upload-video",(function(e,t,n,r){o||(o=document.querySelector(".video-watch")),t===c&&o&&(n&&X(e,o,!1,r),document.getElementById("button-get-remote")&&(document.getElementById("button-get-remote").disabled=!1),_(o))})),V.on("change-user-keep-remote",(function(e){o||(o=document.querySelector(".video-watch")),e===c&&o&&(_(o),document.getElementById("button-get-remote")&&(document.getElementById("button-get-remote").disabled=!1))})),t.default=function(e){c=e.match.params.groupId,B.next(c);var t=Object(v.useState)(I.d.initialState),n=Object(m.a)(t,2),s=n[0],p=n[1],f=Object(v.useState)(null),y=Object(m.a)(f,2),U=y[0],J=y[1],G=Object(v.useState)(null),H=Object(m.a)(G,2),Q=H[0],K=H[1],ne=Object(v.useRef)(),re=Object(v.useRef)(),ae=Object(v.useRef)(),ce=Object(v.useRef)(),oe=Object(v.useRef)(),ue=Object(v.useRef)(),ie=Object(v.useRef)(),se=Object(v.useRef)(),le=Object(v.useRef)(),de=Object(g.a)(["idCartoonUser"]),me=Object(m.a)(de,1)[0],pe=Object(D.f)();function fe(){return be.apply(this,arguments)}function be(){return(be=Object(d.a)(l.a.mark((function e(){var t,n,a,o,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]&&i[1],t&&(n&&alert("Please turn on your webcam"),P(pe,n,s.groupId,oe.current)),t){e.next=13;break}if(R.b.currentState()){e.next=6;break}return e.abrupt("return");case 6:a=R.b.currentState().userId,o=!1;try{navigator.mediaDevices.getUserMedia({video:n,audio:!0}).then((function(e){var t=Object(F.a)();I.d.updateData({peerId:t}),u=new b.a(t,M);var n=document.createElement("video");n.muted=!0,V.emit("new-user",R.b.currentState().avatarImage,R.b.currentState().username,c,a,u.id),V.on("user-join",(function(t,n){n===c&&function(e,t,n){if(u){var r=u.call(e,t);if(r){var a=document.createElement("video");r.on("stream",(function(t){a.id=e,L[r.peer]=r,ee(a,t,n,e)})),r.on("close",(function(){a.remove()})),L[e]=r}}}(t,e,ae.current)})),n.id=u.id,ee(n,e,ae.current,u.id),u.on("call",(function(t){t.answer(e);var n=document.createElement("video");t.on("stream",(function(e){n.id=t.peer,L[t.peer]=t,ee(n,e,ae.current,t.peer)})),t.on("close",(function(){n.remove()}))})),u.on("error",(function(e){console.error(e)})),document.querySelector(".audio-connected")||$("Your device is connected",r,"audio-connected")})).catch(function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=!0,alert("Failing access your device call"),e.next=4,z(a,c);case 4:console.log(t,": join error 1");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(m){o=!0,console.log(m,": join error 2")}if(!o||t){e.next=13;break}return e.next=12,z(a,c);case 12:console.log("user join error");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(v.useEffect)((function(){s.isReconnect&&(console.log("Reconnect"),s.videoUrl&&function(e,t){X(e.videoUrl,o,!1,null),t.current.addEventListener("loadedmetadata",Object(d.a)(l.a.mark((function n(){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.isVideoWatchPlaying&&t.current.play(),_(t.current),t.current.controls=!1,document.getElementById("button-get-remote").disabled=!1,t.current.currentTime=e.timePlayingVideo;case 5:case"end":return n.stop()}}),n)}))))}(s,oe),I.d.updateData({isReconnect:!1}))}),[s.timePlayingVideo]),Object(v.useEffect)((function(){I.d.updateData({groupId:c}),V.on("disconnected-user",function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:L[t]&&(L[t].close(),delete L[t]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(v.useEffect)((function(){var e;return s.isSignIn&&(e=Object(E.a)(2e3).pipe(Object(w.a)(Object(S.a)({url:"/api/theater/"+c+"/members",headers:{authorization:"Bearer "+me.idCartoonUser}}).pipe(Object(j.a)("response","message"),Object(k.a)((function(e){return Object(O.a)(e).pipe(Object(j.a)("response","error"),Object(x.a)((function(){return{error:e}})))}))))).subscribe((function(e){e.error||I.d.updateData({usersOnline:e})}))),function(){e&&e.unsubscribe()}}),[s.isSignIn]),Object(v.useEffect)((function(){o=oe.current,r=re.current,a=me.idCartoonUser;var e,t=I.d.subscribe(p);if(I.d.init(),s.isSignIn||u&&(u.disconnect(),u=null),s.isSignIn)if(I.d.currentState().allowUserJoin&&(fe(!1,s.isVideoCall),K(null),Object(C.e)(!1)),U){var n=document.querySelector(".nav-bar");n&&(n.style.transform="translateY(-100px)"),document.querySelector("#root").allowfullscreen=!0,document.querySelector("#root").requestFullscreen?document.querySelector("#root").requestFullscreen().catch((function(){})):document.querySelector("#root").webkitRequestFullScreen?document.querySelector("#root").webkitRequestFullScreen().catch((function(){})):document.querySelector("#root").mozRequestFullScreen?document.querySelector("#root").mozRequestFullScreen().catch((function(){})):document.querySelector("#root").msRequestFullScreen&&document.querySelector("#root").msRequestFullScreen().catch((function(){}));var i=oe.current;i&&(i.className="video-zoom");var l=document.querySelector(".container-message-dialog");l&&(l.className="container-message-dialog container-message-zoom")}else{var d=document.querySelector(".nav-bar"),m=oe.current,f=document.querySelector(".container-message-dialog");d&&(d.style.transform=""),m&&(m.className=""),function(e){e&&(e.className="container-message-dialog"),document.exitFullscreen?document.exitFullscreen().catch((function(){})):document.webkitExitFullscreen?document.webkitExitFullscreen().catch((function(){})):document.mozCancelFullScreen?document.mozCancelFullScreen().catch((function(){})):document.msExitFullscreen&&document.msExitFullscreen().catch((function(){}))}(f)}return ne&&ne.current&&(e=Object(I.c)(ne.current,c,me.idCartoonUser,K).subscribe((function(e){e&&(I.d.updateData({modeRoom:!1}),ne.current.value="",s.allowFetchCurrentRoomDetail&&function(e,t){te.apply(this,arguments)}(c,me.idCartoonUser))}))),function(){t.unsubscribe(),e&&e.unsubscribe(),I.d.currentState().allowRemoveVideoWatch&&(o&&(o.src=""),o&&o.remove(),o&&(o.muted=!0),o&&_(o),Object(C.e)(!0)),Object(C.d)(!0),document.querySelector(".button-scroll-top").style.display="block"}}),[me.idCartoonUser,U,e.match.params.groupId,s.allowFetchCurrentRoomDetail,s.allowRemoveVideoWatch,s.isSignIn,s.isVideoCall]),Object(v.useEffect)((function(){ae.current&&Object(i.a)(ae.current.children).forEach((function(e){var t=s.usersOnline.find((function(t){return t.peerId===e.id}));t&&(e.poster=t.avatar,e.title=t.username)}))}),[s.peerId,s.usersOnline]),!s.isSignIn&&re.current&&(re.current.innerHTML="",ae.current&&(1===s.usersOnline.length&&B.pipe(Object(N.a)()).subscribe((function(e){V.emit("delete-specific-member",R.b.currentState().peerId,e)})),s.usersOnline=[],ae.current.innerHTML="",Object(C.f)(!1))),h.a.createElement("div",{className:"theater-user-login"},s.isSignIn&&s.currentRoomDetail&&h.a.createElement("div",{className:"section-center"},h.a.createElement("h2",{className:"notification-user-join",ref:re}," "),h.a.createElement("div",null,h.a.createElement("h1",{className:"title-room"},s.currentRoomDetail.roomName),h.a.createElement("div",{className:"container-input-section"},h.a.createElement("div",{className:"input-section-1"},h.a.createElement("div",{style:{width:"90%",display:"flex",flexDirection:"column",alignItems:"flex-end"}},h.a.createElement(q.a,{label:"Video url",input:ue}),h.a.createElement(q.a,{label:"Transcript url",input:ie})),h.a.createElement("div",{className:"input-checkbox"},h.a.createElement("span",null,h.a.createElement("input",{id:"update-other",type:"checkbox",ref:le}),h.a.createElement("label",{htmlFor:"update-other"},"Share with other members")),h.a.createElement("button",{onClick:function(){""!==ue.current.value&&A(ue.current.value,le.current.checked,void 0),""!==ie.current.value&&A(void 0,le.current.checked,ie.current.value)}},"Upload"))),h.a.createElement("div",{className:"input-section-2"},h.a.createElement("input",{type:"file",ref:ce,onChange:function(){var e;(e=ce.current).files[0]&&"video/mp4"===e.files[0].type?(A(URL.createObjectURL(e.files[0]),!1,void 0),e.value=""):alert("required file mp4")}})),h.a.createElement("div",{className:"input-section-3"},h.a.createElement("div",null,h.a.createElement("input",{id:"checkbox-video-call",type:"checkbox",ref:se,defaultChecked:s.isVideoCall}),h.a.createElement("label",{htmlFor:"checkbox-video-call"},"Video")),h.a.createElement("button",{className:"button-check-video-call",onClick:function(){fe(!0,se.current.checked)}},"Reconnect"))),h.a.createElement("div",{title:"Users call",className:"container-audio-call",ref:ae,style:{display:s.usersOnline[0]&&s.usersOnline[0].userId!==s.usersOnline[0].peerId?"flex":"none"}}),s.isSignIn&&h.a.createElement(W,{usersOnline:s.usersOnline}),h.a.createElement("div",{className:"container-section-video"},h.a.createElement(T,{groupId:c,user:R.b.currentState(),withoutName:!0,isZoom:U}),h.a.createElement("div",{className:"wrapper-video-player"},h.a.createElement("video",{className:"video-watch",poster:"https://media.istockphoto.com/videos/movie-time-concept-background-video-id1127766856?s=640x640",ref:oe,onContextMenu:function(e){return e.preventDefault()},playsInline:!0}),h.a.createElement("div",{className:"container-message-dialog"},h.a.createElement("button",{id:"button-get-remote",className:"btn btn-danger",onClick:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.target.disabled=!0,Z(oe.current),e.next=5,Y(c,R.b.currentState().userId);case 5:V.emit("user-keep-remote-changed",c),oe.current.controls=!0;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Get Remote"),h.a.createElement("button",{className:"btn btn-primary button-zoom",onClick:function(){Object(C.d)(!1),U?(document.getElementsByTagName("body").item(0).className="",J(!1)):(document.getElementsByTagName("body").item(0).className="hidden-scroll",J(!0))}},U?h.a.createElement("i",{className:"fas fa-compress"}):h.a.createElement("i",{className:"fas fa-expand"})))),U&&h.a.createElement("div",{className:"button-display-control",onClick:function(){var e=document.querySelector(".container-message-zoom"),t=document.querySelector(".chat-bot");e&&("scale(0)"===t.style.transform?(0!==s.unreadMessage&&V.emit("new-user-seen",R.b.currentState().avatarImage,c),e.style.transform="scale(1)",t.style.transform="scale(1)",t.scroll({top:t.scrollHeight,behavior:"smooth"}),I.d.updateData({unreadMessage:0})):(e.style.transform="scale(0)",t.style.transform="scale(0)"))}},h.a.createElement("i",{className:"far fa-bell fa-4x"}),0!==s.unreadMessage&&h.a.createElement("span",{className:"number-unread-message"},s.unreadMessage))))),h.a.createElement("div",{style:{width:"300px"},hidden:s.isSignIn},h.a.createElement(q.a,{label:"Password Room",type:"password",input:ne,error:Q})))}}}]);
//# sourceMappingURL=51.9dd520e0.chunk.js.map