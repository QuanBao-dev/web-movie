(this["webpackJsonpmy-app-2"]=this["webpackJsonpmy-app-2"]||[]).push([[38],{127:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(54);var r=a(59);function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(r.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},133:function(e,t,a){"use strict";a(141);var n=a(0),r=a.n(n);t.a=function(e){var t=e.label,a=e.input,n=e.type,c=e.error,s=void 0===c?null:c,u=e.defaultValue,o=void 0===u?"":u,i=e.onKeyUp;return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("div",{className:"form-custom"},r.a.createElement("input",{onKeyUp:i,defaultValue:o,ref:a,type:n||"text",required:!0}),r.a.createElement("label",{className:"label-name"},t)),s&&r.a.createElement("div",{className:"error-message"},s))}},141:function(e,t,a){},200:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,t="",a=crypto.getRandomValues(new Uint8Array(e));e--;){var n=63&a[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t}},281:function(e,t,a){"use strict";a.r(t);var n,r,c=a(18),s=a.n(c),u=a(36),o=a(127),i=a(26),l=(a(282),a(200)),m=a(0),p=a.n(m),d=a(120),f=a(188),b=a(189),g=a(44),v=a(133);function y(e){var t=e.v,a=e.user,n=e.index,r=e.malId,c=e.cookies,s=e.containerInputRefs,u=e.buttonSubmitRefs;return p.a.createElement("div",{style:{marginLeft:t.marginLeft},className:"comment"},a&&a.userId===t.userId&&p.a.createElement(x,{v:t,malId:r,cookies:c}),p.a.createElement(h,{v:t,user:a,containerInputRefs:s,buttonSubmitRefs:u,index:n}))}function h(e){var t=e.v,a=e.user,n=e.containerInputRefs,r=e.buttonSubmitRefs,c=e.index;return p.a.createElement("div",null,p.a.createElement("div",{className:"container-avatar"},p.a.createElement("img",{className:"image-avatar",width:"50",height:"50",src:t.avatar||"https://iupac.org/wp-content/uploads/2018/05/default-avatar.png",alt:"image_avatar"})),p.a.createElement("div",null,p.a.createElement("div",{className:"time-since-comment"},"Recently"===Object(f.c)(new Date(t.createdAt).getTime())?"Recently":"".concat(Object(f.c)(new Date(t.createdAt).getTime())," ago")),p.a.createElement("div",{className:"author"},t.author),p.a.createElement("div",{className:"content-comment"},p.a.createElement("div",{dangerouslySetInnerHTML:{__html:t.textContent}}),p.a.createElement("div",{className:"button-comment-reply",onClick:function(){return function(e,t,a,n){e&&(t.forEach((function(e,t){e.current&&(e.current.style.display="none",a[t].current.disabled=!0)})),t[n].current.style.display="block",f.a.updateData({indexInputDisplayBlock:n}))}(a,n,r,c)}},p.a.createElement("i",{className:"fas fa-reply fa-1x"})))))}function E(e){var t=e.containerInputRefs,a=e.index,n=e.v,r=e.inputAuthorRefs,c=e.inputRefs,s=e.buttonSubmitRefs,u=e.malId;return p.a.createElement("div",{ref:t[a],style:{marginLeft:n.marginLeft,marginBottom:"50px",display:"none"}},p.a.createElement(v.a,{label:"Name",input:r[a]}),p.a.createElement("h1",null,"Your comment"),p.a.createElement("div",{className:"textarea-comment-container"},p.a.createElement("div",{className:"textarea-comment",onPaste:function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)},ref:c[a],contentEditable:!0,suppressContentEditableWarning:!0})),p.a.createElement("button",{className:"btn btn-danger button-submit-comment",ref:s[a],onClick:function(){S(u,r[a].current,c[a].current,"".concat(parseInt(n.marginLeft.replace(/px/g,""))+50,"px"),a),t[a].current.style.display="none"}},"Submit"))}function x(e){var t=e.v,a=e.malId,n=e.cookies;return p.a.createElement("div",{onClick:Object(u.a)(s.a.mark((function e(){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.a.updateIsShowBlockPopUp(!0),e.prev=1,e.next=4,fetch("/api/movies/message/delete/"+a,{method:"PUT",body:JSON.stringify({commentId:t.commentId}),headers:{authorization:"Bearer ".concat(n.idCartoonUser),"Content-Type":"application/json"}});case 4:1!==f.a.currentState().currentPage?f.a.updateData({messages:[],currentPage:1,lastPageComment:1}):f.a.updateData({triggerFetch:!f.a.currentState().triggerFetch,messages:[],lastPageComment:1}),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),r=e.t0.response.data.error.message,alert(r),1!==f.a.currentState().currentPage?f.a.updateData({messages:[],currentPage:1,lastPageComment:1}):f.a.updateData({triggerFetch:!f.a.currentState().triggerFetch,messages:[],lastPageComment:1});case 12:g.a.updateIsShowBlockPopUp(!1);case 13:case"end":return e.stop()}}),e,null,[[1,7]])}))),className:"delete-symbol"},"X")}function I(e){return Array.from(Array(e).keys()).map((function(){return Object(m.createRef)()}))}function S(e,t,a,n,r,c){return k.apply(this,arguments)}function k(){return(k=Object(u.a)(s.a.mark((function e(t,a,c,u,o,i){var m,p,d,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(m=c.innerText.match(/http[s]?:\/\/(?:[a-z]|[0-9]|[$-_@.&+#]|[!*(),]|(?:%[0-9a-f][0-9a-f]))+/g))&&(c.innerHTML=c.innerHTML.replace(m[0],"<a href=".concat(m[0],' target="_blank" style="color:white">').concat(m[0],"</a>"))),p={userId:r.userId,author:a.value,createdAt:new Date(Date.now()).toISOString(),textContent:c.innerHTML,commentId:Object(l.a)(),marginLeft:u},Object(b.b)(p.author),d=f.a.currentState().messages[o]?f.a.currentState().messages[o].commentId:null,e.prev=5,g.a.updateIsShowBlockPopUp(!0),e.next=9,fetch("/api/movies/".concat(t),{method:"PUT",body:JSON.stringify({newMessage:p,commentId:d,isPush:i}),headers:{authorization:"Bearer "+n,"Content-Type":"application/json"}});case 9:1!==f.a.currentState().currentPage?f.a.updateData({messages:[],currentPage:1,lastPageComment:1}):f.a.updateData({triggerFetch:!f.a.currentState().triggerFetch,messages:[],lastPageComment:1}),c.innerText="",e.next=18;break;case 13:e.prev=13,e.t0=e.catch(5),v=e.t0.response.data.error.message,alert(v),1!==f.a.currentState().currentPage?f.a.updateData({messages:[],currentPage:1,lastPageComment:1}):f.a.updateData({triggerFetch:!f.a.currentState().triggerFetch,messages:[],lastPageComment:1});case 18:g.a.updateIsShowBlockPopUp(!1);case 19:case"end":return e.stop()}}),e,null,[[5,13]])})))).apply(this,arguments)}t.default=function(e){var t=e.malId,a=e.user;r=a,f.a.initialState.malId=t;var c=Object(m.useState)(f.a.initialState),s=Object(i.a)(c,2),u=s[0],l=s[1],h=Object(d.a)(["idCartoonUser"]),x=Object(i.a)(h,1)[0];n=x&&x.idCartoonUser;var k=Object(m.useRef)(),P=Object(m.useRef)(),j=Object(m.useRef)(),D=Object(m.useRef)(),O=u.messages.length,C=I(O),N=I(O),w=I(O),R=I(O);Object(m.useEffect)((function(){return function(){g.a.updateIsShowBlockPopUp(!1),f.a.updateData({messages:[]})}}),[]),Object(m.useEffect)((function(){a&&Object(b.b)(a.username)}),[a]),Object(m.useEffect)((function(){var e;return e=Object(f.b)(t).subscribe((function(e){var t=e.data,a=e.lastPage,n=[].concat(Object(o.a)(f.a.currentState().messages),Object(o.a)(t));f.a.updateMessages(n,a),D.current.style.display="block"})),function(){e&&e.unsubscribe()}}),[u.currentPage,u.triggerFetch]),Object(m.useEffect)((function(){var e,t,n=f.a.subscribe(l);return f.a.init(),a&&(P.current.value=f.a.currentState().currentName,null!==u.indexInputDisplayBlock&&N[u.indexInputDisplayBlock]&&w[u.indexInputDisplayBlock]&&R[u.indexInputDisplayBlock]&&(w[u.indexInputDisplayBlock].current.value=f.a.currentState().currentName,e=Object(f.d)(N[u.indexInputDisplayBlock].current,w[u.indexInputDisplayBlock].current,R[u.indexInputDisplayBlock].current,a).subscribe()),t=Object(f.d)(k.current,P.current,j.current).subscribe()),function(){n.unsubscribe(),e&&e.unsubscribe(),t&&t.unsubscribe()}}),[R,u.currentPage,u.indexInputDisplayBlock,u.shouldFetchComment,w,N,a]);var B=document.getElementsByClassName("comment-button-see").item(0);return B&&(u.currentPage>=u.lastPageComment?B.style.display="none":B.style.display="block"),p.a.createElement("div",{className:"wrapper-messages",ref:D},p.a.createElement("h2",null,"Comments"),p.a.createElement("div",{style:{marginBottom:"50px",display:"flex",flexDirection:"column",alignItems:"flex-end"}},p.a.createElement(v.a,{label:"Name",input:P}),p.a.createElement("h2",{style:{width:"100%"}},"Your comment"),p.a.createElement("div",{className:"textarea-comment-container"},p.a.createElement("div",{className:"textarea-comment",onPaste:function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)},ref:k,contentEditable:!0,suppressContentEditableWarning:!0})),a&&p.a.createElement("button",{className:"btn btn-danger button-submit-comment",ref:j,onClick:function(){S(t,P.current,k.current,"".concat(50,"px"),null,!1)}},"Submit"),!a&&p.a.createElement("h3",null,"You need to sign in to comment")),u.messages.map((function(e,n){return p.a.createElement("div",{key:n},p.a.createElement(y,{v:e,user:a,index:n,malId:t,cookies:x,containerInputRefs:C,buttonSubmitRefs:R}),p.a.createElement(E,{containerInputRefs:C,index:n,v:e,inputAuthorRefs:w,inputRefs:N,buttonSubmitRefs:R,malId:t}))})),p.a.createElement("div",{className:"comment-button-see",onClick:function(){var e=u.currentPage;f.a.updateCurrentPage(e+1)}},"See more"))}},282:function(e,t,a){}}]);
//# sourceMappingURL=38.5e2a3a30.chunk.js.map