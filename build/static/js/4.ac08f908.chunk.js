(this["webpackJsonpmy-app-2"]=this["webpackJsonpmy-app-2"]||[]).push([[4],{200:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,t="",a=crypto.getRandomValues(new Uint8Array(e));e--;){var n=63&a[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t}},210:function(e,t,a){"use strict";a.r(t);var n=a(127),r=a(18),s=a.n(r),c=a(36),o=a(26),i=a(133),u=(a(283),a(0)),l=a.n(u),m=a(107),g=a(150),p=a(140),d=a(30),f=a(75),b={imgsMessage:[],isInBottomChatBot:!0},y=new f.a(b),v=b,h={initialState:b,subscribe:function(e){return y.subscribe(e)},init:function(){v=Object(d.a)(Object(d.a)({},v),{},{imgsMessage:[],isInBottomChatBot:!0}),y.next(v)},currentState:function(){var e;return y.subscribe((function(t){return e=t})),e||b},updateImgsMessage:function(e){v=Object(d.a)(Object(d.a)({},v),{},{imgsMessage:[].concat(Object(n.a)(v.imgsMessage),[e])}),y.next(v)},deleteImageByIndex:function(e){v=Object(d.a)(Object(d.a)({},v),{},{imgsMessage:[].concat(Object(n.a)(v.imgsMessage.slice(0,e)),Object(n.a)(v.imgsMessage.slice(e+1,v.imgsMessage.length)))}),y.next(v)},updateIsInBottomChatBot:function(e){v=Object(d.a)(Object(d.a)({},v),{},{isInBottomChatBot:e}),y.next(v)}};var E=a(170),N=(a(284),a(200)),w=a(308),S=Object(N.a)();function x(e,t,a,n,r,s,c,o,i,u,l){var m={text:e,images:t};if(!a){if(""===n.current.value.trim())return r("please type in your name"),"wrong";r(null)}if(m.images.length>0&&m.images.forEach((function(e){if(s(e,"You",!0,c,o?o.avatarImage:void 0),o){u.emit("new-message-photo",n.current&&""!==n.current.value.trim()?n.current.value:o.username,e,i,o.avatarImage);var t=document.getElementById("button-get-remote");t&&u.emit("update-user-online",t.disabled)}else u.emit("new-message-photo",n.current&&""!==n.current.value.trim()?n.current.value:o.username,e,i)})),m.text&&""!==m.text.trim())if(l(m.text,"You",!0,c,o?o.avatarImage:void 0),o){u.emit("new-message",n.current&&""!==n.current.value.trim()?n.current.value:o.username,m.text,i,o.avatarImage);var g=document.getElementById("button-get-remote");g&&u.emit("update-user-online",g.disabled)}else u.emit("new-message",n.current&&""!==n.current.value.trim()?n.current.value:o.username,m.text,i)}var O,j,M,k,q=function(e){var t=e.appendNewMessageDialog,a=e.appendNewPhotoMessage,n=e.inputNameDialogRef,r=e.idGroup,s=e.socket,c=e.user,i=e.messageDialogE,p=e.isWithoutName,d=e.setErrorName,f=Object(u.useState)(h.initialState),b=Object(o.a)(f,2),y=b[0],v=b[1],E=Object(u.useRef)();return Object(u.useEffect)((function(){var e=h.subscribe(v);return h.init(),s.on("reconnect",(function(){s.emit("notify-user-stop-type",r,S)})),s.on("disconnect",(function(){s.emit("notify-user-stop-type",r,S)})),function(){e.unsubscribe()}}),[]),Object(u.useEffect)((function(){var e,t;return e=Object(m.a)(E.current,"input").pipe(Object(w.a)()).subscribe((function(){p?s.emit("notify-user-typing",r,S,c.username):s.emit("notify-user-typing",r)})),t=Object(m.a)(E.current,"input").pipe(Object(g.a)(600)).subscribe((function(){s.emit("notify-user-stop-type",r,S),Object(m.a)(E.current,"input").pipe(Object(w.a)()).subscribe((function(){p?s.emit("notify-user-typing",r,S,c.username):s.emit("notify-user-typing",r)}))})),function(){e&&e.unsubscribe(),t&&t.unsubscribe()}}),[r,p,s,c]),E.current&&(E.current.innerHTML=E.current.innerText,""===E.current.innerHTML&&0===y.imgsMessage.length&&(E.current.style.transition="0.4s",E.current.style.width="40px")),y.imgsMessage.length>0&&(E.current.style.transition="0s",E.current.style.width="100%"),l.a.createElement("div",{className:"message-input-wrapper"},l.a.createElement("div",{className:"img-message-input"},y.imgsMessage.map((function(e,t){return l.a.createElement("div",{key:t,className:"img-detail-wrapper"},l.a.createElement("img",{src:e,alt:"NOT_FOUND",width:"100%",height:"100%"}),l.a.createElement("span",{className:"delete-symbol-message",onClick:function(){h.deleteImageByIndex(t)}},"X"))}))),l.a.createElement("div",{className:"container-send-message-input"},l.a.createElement("div",{contentEditable:!0,"data-placeholder":"Aa",ref:E,suppressContentEditableWarning:!0,onPaste:function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");if(-1!==e.clipboardData.items[0].type.indexOf("image")){var a=e.clipboardData.items[0].getAsFile(),n=new FileReader;n.onload=function(e){h.updateImgsMessage(e.target.result)},n.readAsDataURL(a)}document.execCommand("insertHTML",!1,t)},className:"message-input-container",onTouchStart:function(e){e.target.style.transition="0.4s",e.target.style.width="100%"},onBlur:function(e){""===e.target.innerHTML.replace(/&nbsp;( )?/g,"")&&y.imgsMessage.length<=0?(e.target.style.transition="0.4s",e.target.style.width="40px"):(e.target.style.transition="0.4s",e.target.style.width="100%")},onInput:function(e){(""!==e.target.innerHTML.replace(/&nbsp;( )?/g,"")||y.imgsMessage.length>0)&&(e.target.style.width="100%");var t=(e.target.innerHTML||"").match(/<img src="[a-zA-Z0-9:/;,+=@#$%^&*\\]+" alt="">/g);if(t&&(t=t[0]),t){var a=t.match(/data:image\/[a-zA-Z0-9:/;,+=@#$%^&*\\]+/g);h.updateImgsMessage(a)}},onKeyUp:function(){""===E.current.innerHTML&&0===y.imgsMessage.length&&(E.current.style.transition="0.4s",E.current.style.width="40px")},onKeyDown:function(e){if(""===E.current.innerHTML&&0===y.imgsMessage.length&&(E.current.style.transition="0.4s",E.current.style.width="40px"),function(e,t){if(0===window.getSelection().focusOffset)if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var a=document.createRange();a.selectNodeContents(e),a.collapse(t);var n=window.getSelection();n.removeAllRanges(),n.addRange(a)}else if("undefined"!=typeof document.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(t),r.select()}}(e.target,!1),13===e.keyCode){if(""===e.target.innerHTML.replace(/&nbsp;( )?/g,"")&&0===y.imgsMessage.length)return void e.preventDefault();"wrong"!==x(e.target.innerHTML,y.imgsMessage,p,n,d,a,i,c,r,s,t)&&(e.target.innerHTML="",h.init()),e.preventDefault()}}}),l.a.createElement("i",{className:"far fa-paper-plane fa-2x",style:{cursor:"pointer",marginLeft:"10px",fontSize:"1.7rem"},onClick:function(e){var o=document.querySelector(".message-input-container");"wrong"!==x(o.innerHTML,y.imgsMessage,p,n,d,a,i,c,r,s,t)&&(o.innerHTML="",h.init()),e.preventDefault()}})))},I=E.d.socket;function T(e){var t=document.querySelector(".message-dialog");if(t){var a=Object(n.a)(t.childNodes),r=a[a.length-1].querySelector(".seen-user"),s=!1;r||(s=!0,(r=document.createElement("div")).className="seen-user");var c=document.createElement("span"),o=document.createElement("img");o.src=e,o.alt="image_avatar",c.append(o),r.append(c),s&&a[a.length-1].append(r)}}function B(){document.querySelector("#root").allowfullscreen=!0,document.querySelector("#root").requestFullscreen?document.querySelector("#root").requestFullscreen().catch((function(){})):document.querySelector("#root").webkitRequestFullScreen?document.querySelector("#root").webkitRequestFullScreen().catch((function(){})):document.querySelector("#root").mozRequestFullScreen?document.querySelector("#root").mozRequestFullScreen().catch((function(){})):document.querySelector("#root").msRequestFullScreen&&document.querySelector("#root").msRequestFullScreen().catch((function(){}))}function R(e){return new Promise((function(t,a){var n=new FileReader;n.onerror=function(){a("Your file is too big")},n.onload=function(e){n.error&&a(n.error),t(e.target.result)},n.readAsDataURL(e)}))}function C(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document.querySelector(".message-dialog"),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"https://iupac.org/wp-content/uploads/2018/05/default-avatar.png",s=document.createElement("div"),c=document.createElement("span"),o=document.createElement("p"),i=document.createElement("img");i.src=r,i.className="avatar-user-chat",i.alt="avatar",s.className=a?"flex-end-message message-dialog-item other-user-message":"flex-start-message message-dialog-item current-user-message",s.append(i),/button-like/g.test(e)||(c.className="content-message");var u=e.match(/http[s]?:\/\/(?:[a-z]|[0-9]|[$-_@.&+]|[!*(),]|(?:%[0-9a-f][0-9a-f]))+/g);u&&(e=e.replace(u[0],"<a href=".concat(u[0],' target="_blank" style="color:white">').concat(u[0],"</a>"))),c.innerHTML="<p>".concat(e,"</p>"),o.className="username-message",o.innerText=t,s.append(c),s.append(o),n.append(s),D(a);var l=document.querySelector(".chat-watch-zoom");if(l&&"scale(0)"===l.style.transform){var m=E.d.currentState().unreadMessage;E.d.updateData({unreadMessage:m+1})}}function D(e){if(e)L();else if(h.currentState())if(h.currentState().isInBottomChatBot)L();else{var t=document.querySelector(".button-scroll-bottom");t&&(t.style.transform="translateY(0)")}}function H(){var e=document.querySelector(".container-message-chat-bot");return!!e&&e.scrollHeight-(e.scrollTop+e.offsetHeight)<40}function L(){var e=document.querySelector(".container-message-chat-bot");e&&e.scroll({top:e.scrollHeight,behavior:"smooth"})}function F(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document.querySelector(".message-dialog"),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"https://iupac.org/wp-content/uploads/2018/05/default-avatar.png",s=document.createElement("div"),c=document.createElement("span"),o=document.createElement("p"),i=document.createElement("img");i.className="avatar-user-chat",i.src=r,i.alt="avatar",s.className=a?"flex-end-message message-dialog-item other-user-message":"flex-start-message message-dialog-item current-user-message",s.append(i),c.className="pop-up";var u=document.querySelector(".container-popup-img"),l=document.querySelector(".pop-up-active");c.onclick=function(e){"pop-up"===e.target.parentElement.className&&(document.querySelector(".block-pop-up").style.display="block",document.getElementsByTagName("body").item(0).className="hidden-scroll",l.src=e.target.src,l.width=e.target.naturalWidth,l.height=e.target.naturalHeight,u.style.transition="0.4s",u.style.display="flex",u.style.transform="scale(1)",u.style.opacity="1"),document.onclick=function(t){!e.target.parentElement.contains(t.target)&&document.querySelector(".block-pop-up")&&(document.querySelector(".block-pop-up").style.display="none",document.getElementsByTagName("body").item(0).className="",l.src="",e.target.parentElement.className="pop-up",u.style.opacity="0",u.style.transition="0s",u.style.transform="scale(0)")}},c.innerHTML='<img width="100%" height="100%" src='.concat(e,' alt="image_photo"/>'),o.className="username-message",o.innerText=t,s.append(c),s.append(o),n.append(s),D(a);var m=document.querySelector(".chat-watch-zoom");if(m&&"scale(0)"===m.style.transform){var g=E.d.currentState().unreadMessage;E.d.updateData({unreadMessage:g+1})}}I.on("send-message-other-users",(function(e,t,a,n){if(a===j&&(C(t,e,!1,O,n||"https://iupac.org/wp-content/uploads/2018/05/default-avatar.png"),M)){T(n);var r=document.querySelector(".chat-bot");r&&"scale(0)"!==r.style.transform&&I.emit("new-user-seen",k.avatarImage,a)}})),I.on("send-message-photo-other-users",(function(e,t,a,n){if(a===j&&(F(t,e,!1,O,n||"https://iupac.org/wp-content/uploads/2018/05/default-avatar.png"),M)){T(n);var r=document.querySelector(".chat-bot");r&&"scale(0)"!==r.style.transform&&I.emit("new-user-seen",k.avatarImage,a)}})),I.on("send-avatar-seen-user-to-other-user",(function(e,t){t===j&&M&&T(e)})),I.on("new-user-typing",(function(e,t,a){e===j&&(M?function(e,t){var a=document.querySelector(".notification-typing-theater-room");if(!a)return;var n=document.createElement("div");n.id=e,n.className="notification-item-typing";var r=document.createElement("img");r.className="image-dot",r.src="https://support.signal.org/hc/article_attachments/360016877511/typing-animation-3x.gif",r.alt="gif_3dot";var s=document.createElement("div");s.className="username-message",s.innerText="".concat(t),n.append(r),n.append(s),a&&a.append(n)}(t,a):document.querySelector(".notification-typing")&&(document.querySelector(".notification-typing").style.display="block")),h.currentState()&&h.currentState().isInBottomChatBot&&L()})),I.on("eliminate-user-typing",(function(e,t){e===j&&(M?function(e){var t=document.querySelector(".notification-typing-theater-room");if(t){var a=Object(n.a)(t.childNodes).find((function(t){return t.id===e}));a&&a.remove()}h.currentState().isInBottomChatBot&&L()}(t):document.querySelector(".notification-typing")&&(document.querySelector(".notification-typing").style.display="none")),h.currentState().isInBottomChatBot&&L()}));t.default=function(e){var t=e.groupId,a=e.user,n=e.withoutName,r=void 0!==n&&n,d=e.isZoom,f=void 0!==d&&d;j=t,k=a,M=r;var b=Object(u.useRef)(),y=Object(u.useRef)(),v=Object(u.useRef)(),E=Object(u.useRef)(),N=Object(u.useRef)(null),w=Object(u.useState)(null),S=Object(o.a)(w,2),x=S[0],T=S[1];return O=y.current,Object(u.useEffect)((function(){O=y.current,a&&!r&&(b.current.value=a.username)}),[a,r,f]),Object(u.useEffect)((function(){O=y.current,I.connected||I.connect(),h.init();var e=Object(m.a)(N.current,"scroll").pipe(Object(g.a)(500),Object(p.a)((function(){return H()}))).subscribe((function(){h.updateIsInBottomChatBot(!0),document.querySelector(".button-scroll-bottom").style.transform="translateY(-100px)"})),t=Object(m.a)(N.current,"scroll").pipe(Object(g.a)(500),Object(p.a)((function(){return!H()}))).subscribe((function(){h.updateIsInBottomChatBot(!1)}));return function(){e.unsubscribe(),t.unsubscribe(),I.close()}}),[]),Object(u.useEffect)((function(){var e;return O=y.current,E.current&&(e=Object(m.a)(E.current,"click").pipe(Object(g.a)(500)).subscribe((function(){O&&(a?b.current?""!==b.current.value.trim()?(T(null),C('<i class="fas fa-thumbs-up fa-3x button-like"></i>',"you",!0,O,a.avatarImage),I.emit("new-message",b.current.value,'<i class="fas fa-thumbs-up fa-3x button-like"></i>',j,a.avatarImage)):T("please type in your name"):(C('<i class="fas fa-thumbs-up fa-3x button-like"></i>',"you",!0,O,a.avatarImage),I.emit("new-message",a.username,'<i class="fas fa-thumbs-up fa-3x button-like"></i>',j,a.avatarImage)):""!==b.current.value.trim()?(T(null),C('<i class="fas fa-thumbs-up fa-3x button-like"></i>',"you",!0,O),I.emit("new-message",b.current.value,'<i class="fas fa-thumbs-up fa-3x button-like"></i>',j)):T("Error: please type in your name"))}))),function(){e.unsubscribe()}}),[a]),l.a.createElement("div",{className:"container-chat-bot"},l.a.createElement("div",{className:"container-popup-img"},l.a.createElement("img",{className:"pop-up-active",src:"",alt:""})),l.a.createElement("div",{className:"block-pop-up",style:{display:"none"}}),l.a.createElement("div",{className:"chat-bot".concat(f?" chat-watch-zoom":"")},l.a.createElement("div",{className:"button-scroll-bottom",onClick:function(){L()}},l.a.createElement("i",{className:"fas fa-arrow-alt-circle-down fa-3x"})),l.a.createElement("div",{className:"message-dialog-container".concat(f?" transparent-background":"")},l.a.createElement("div",{className:"container-message-chat-bot",ref:N,style:{backgroundColor:f?"":"black"}},l.a.createElement("div",{className:"message-dialog".concat(f?" transparent-background":""),ref:y},l.a.createElement("div",{className:"flex-start-message message-dialog-item current-user-message"},l.a.createElement("span",{className:"content-message"},"Welcome to AnimeFun, enjoy and have a good day"),l.a.createElement("span",{className:"username-message"},"Robot"))),M&&l.a.createElement("div",{className:"notification-typing-theater-room"}),!M&&l.a.createElement("div",{className:"notification-typing"},l.a.createElement("img",{className:"image-dot",src:"https://support.signal.org/hc/article_attachments/360016877511/typing-animation-3x.gif",alt:"gif_3_dot"}),l.a.createElement("div",null,"Someone"))),!r&&l.a.createElement(i.a,{label:"Name",input:b,error:x}),l.a.createElement("div",{className:"input-message-dialog"},l.a.createElement("i",{className:"fas fa-thumbs-up fa-2x button-like",style:{color:"white"},ref:E,onClick:function(){}}),l.a.createElement("i",{className:"fas fa-images fa-2x symbol-choose-picture",onClick:function(){return v.current.click()}}),l.a.createElement(q,{appendNewMessageDialog:C,appendNewPhotoMessage:F,inputNameDialogRef:b,idGroup:j,socket:I,user:a,messageDialogE:O,isWithoutName:M,setErrorName:T}),l.a.createElement("input",{multiple:!0,type:"file",ref:v,className:"file-submit-input",onChange:Object(c.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=0;case 2:if(!(t<v.current.files.length)){e.next=13;break}if(-1!==v.current.files[t].type.indexOf("image")){e.next=6;break}return alert("Just image or gif"),e.abrupt("continue",10);case 6:return e.next=8,R(v.current.files[t]);case 8:a=e.sent,h.updateImgsMessage(a);case 10:t++,e.next=2;break;case 13:f&&B(),v.current.value="",e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),alert(e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})))})))))}},283:function(e,t,a){},284:function(e,t,a){}}]);
//# sourceMappingURL=4.ac08f908.chunk.js.map