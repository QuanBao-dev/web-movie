{"version":3,"sources":["store/caches.js","../../../src/internal/Notification.ts","store/animeDetail.js","epics/animeDetail.js","epics/theater.js","store/theater.js","epics/comment.js","store/comment.js","../../../../src/internal/operators/delay.ts","store/pageWatch.js","epics/pageWatch.js","pages/EpisodePage/EpisodePage.js"],"names":["initialState","behaviorSubject","BehaviorSubject","state","cachesStore","subscribe","setState","value","currentState","ans","updateData","obj","next","NotificationKind","Notification","kind","error","observe","observer","do","accept","nextOrObserver","complete","toObservable","of","throwError","err","dataInformationAnime","dataVideoPromo","dataEpisodesAnime","dataLargePicture","dataLargePictureList","isAddMode","malId","triggerFetch","dataRelatedAnime","pageRelated","isLoadingCharacter","isLoadingInfoAnime","isLoadingVideoAnime","isLoadingLargePicture","isLoadingEpisode","isLoadingRelated","nameStore","updateIsLoading","bool","key","resetState","v","object","animeDetailStream","animeDetailStore","fetchData$","name","type","timer","pipe","tap","mergeMapTo","iif","dataInfo","map","delay","ajax","pluck","retry","switchMap","data","includes","status","fetchAnimeThemes$","themes","takeWhile","switchMapTo","fetchAnimeExternal$","externals","fetchDataVideo$","fetchEpisodeDataVideo$","catchError","console","log","fetchLargePicture$","document","body","style","backgroundImage","backgroundSize","pictures","jpg","webp","large_image_url","fetchBoxMovieOneMovie$","idCartoonUser","url","headers","authorization","capitalizeString","string","replace","capitalize","fetchAnimeRecommendation$","fetchDataCharacter$","dataCharacter","handleAddBoxMovie","addMovieRef","debounceTime","filter","current","fromEvent","exhaustMap","method","mal_id","title","imageUrl","episodes","score","airing","synopsis","typeResponse","handleDeleteBoxMovie","deleteMovieRef","theaterStream","theaterStore","validateForm$","buttonSubmitElement","disabled","elements","from","element","combineAll","events","check","valueInputs","event","target","length","fetchRoomsData$","submitFormPasswordRoom$","inputElement","groupId","setErrorPassword","e","keyCode","password","response","fetchUserOnline$","rooms","allowFetchRooms","currentRoomDetail","isSignIn","notifications","roomsLoginId","allowFetchCurrentRoomDetail","usersOnline","modeRoom","userId","allowRemoveVideoWatch","allowUserJoin","unreadMessage","timePlayingVideo","videoUrl","isVideoCall","isControlVideoWatching","isReconnect","isTriggerReconnect","isVideoWatchPlaying","peerId","isDisableReconnectButton","socket","io","connect","upgrade","transports","temp","init","updateAllowFetchRooms","updateSignIn","updateAllowFetchCurrentRoomDetail","updateAllowRemoveVideoWatch","updateAllowUserJoin","chatStream","chatStore","validateInput$","inputAuthorElement","inputAuthor$","startWith","currentName","input$","textAuthor","trim","fetchPageMessage$","currentPage","res","message","timeSince","date","seconds","Math","floor","Date","interval","messages","numberCommentOfEachPage","indexInputDisplayBlock","shouldFetchComment","lastPageComment","updateMessages","lastPage","updateCurrentPage","page","updateCurrentName","scheduler","async","source","DelayOperator","call","_super","DelaySubscriber","destination","_this","queue","notification","delay_1","schedule","prototype","_schedule","active","DelayMessage","scheduleNotification","_error","errored","unsubscribe","_complete","time","reviewsData","pageReviewsData","pageReviewsOnDestroy","isStopFetchingReviews","shouldUpdatePageReviewData","previousMalId","pageSplit","switchVideo","pageWatchStream","updateSwitchVideo","updateInfoPageWatch","updateTitle","updateImageUrl","updatePageSplit","updateReviewsData","resetReviewsData","updatePageReviewsOnDestroy","allowUpdatePageReviewsData","updateIsStopFetching","updatePageReview","updatePreviousMalId","updateEpisodes","fetchEpisodesOfMovie$","Comment","loadable","Chat","fallback","color","size","margin","VideoPlayerSection","ListEpisodeUrlDisplay","episode","mode","modeDisplay","className","ep","index","to","EpisodePage","props","match","params","history","useHistory","useState","pageWatchState","setPageWatchState","isDisplayVietSub","setIsDisplayVietSub","isDisplayEngSub","setIsDisplayEngSub","isDisplayEngDub","setIsDisplayEngDub","user","userStream","useEffect","subscription","window","scroll","top","fetchEpisodesSub","fetchTitleAnimeSub","emit","username","fetchTitle$","images","image_url","currentEpisode","episodesEng","episodesEngDub","find","parseFloat","episodeIndex","findIndex","onClick","push","maxHeight"],"mappings":"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","file":"static/js/32.29821ad7.chunk.js","sourcesContent":["import { BehaviorSubject } from \"rxjs\";\r\nconst initialState = {};\r\nconst behaviorSubject = new BehaviorSubject(initialState);\r\nlet state = initialState;\r\nconst cachesStore = {\r\n  subscribe: (setState) =>\r\n    behaviorSubject.subscribe((value) => setState(value)),\r\n  currentState: () => {\r\n    let ans;\r\n    behaviorSubject.subscribe((value) => {\r\n      ans = value;\r\n    });\r\n    return ans;\r\n  },\r\n  updateData: (obj) => {\r\n    state = {\r\n      ...state,\r\n      ...obj,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n};\r\n\r\nexport default cachesStore;\r\n",null,"import { BehaviorSubject } from \"rxjs\";\r\n\r\nconst initialState = {\r\n  dataInformationAnime: {},\r\n  dataVideoPromo: [],\r\n  dataEpisodesAnime: {},\r\n  dataLargePicture: \"\",\r\n  dataLargePictureList: [],\r\n  isAddMode: null,\r\n  malId: null,\r\n  triggerFetch:null,\r\n  dataRelatedAnime: [],\r\n  pageRelated: 1,\r\n  isLoadingCharacter: null,\r\n  isLoadingInfoAnime: null,\r\n  isLoadingVideoAnime: null,\r\n  isLoadingLargePicture: null,\r\n  isLoadingEpisode: null,\r\n  isLoadingRelated: null,\r\n};\r\nconst behaviorSubject = new BehaviorSubject(initialState);\r\nlet state = initialState;\r\nconst nameStore = {\r\n  initialState,\r\n  subscribe: (setState) => behaviorSubject.subscribe(setState),\r\n  updateIsLoading: (\r\n    bool,\r\n    key = \"isLoadingCharacter\" ||\r\n      \"isLoadingInfoAnime\" ||\r\n      \"isLoadingVideoAnime\" ||\r\n      \"isLoadingLargePicture\" ||\r\n      \"isLoadingEpisode\" ||\r\n      \"isLoadingRelated\"\r\n  ) => {\r\n    state = {\r\n      ...state,\r\n      [key]: bool,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  resetState: () => {\r\n    state = {\r\n      ...state,\r\n      ...initialState,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  currentState: () => {\r\n    let ans;\r\n    behaviorSubject.subscribe((v) => (ans = v));\r\n    return ans || initialState;\r\n  },\r\n  updateData: (object = initialState) => {\r\n    state = {\r\n      ...state,\r\n      ...object,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n};\r\n\r\nexport default nameStore;\r\n","import capitalize from \"lodash/capitalize\";\r\nimport { fromEvent, iif, of, throwError, timer } from \"rxjs\";\r\nimport { ajax } from \"rxjs/ajax\";\r\nimport {\r\n  catchError,\r\n  debounceTime,\r\n  exhaustMap,\r\n  filter,\r\n  map,\r\n  mergeMapTo,\r\n  pluck,\r\n  retry,\r\n  switchMap,\r\n  switchMapTo,\r\n  takeWhile,\r\n  tap,\r\n  delay,\r\n} from \"rxjs/operators\";\r\n\r\nimport animeDetailStore from \"../store/animeDetail\";\r\nimport cachesStore from \"../store/caches\";\r\n\r\nexport const animeDetailStream = animeDetailStore;\r\n\r\nexport const fetchData$ = (name, type) => {\r\n  return timer(0).pipe(\r\n    tap(() => {\r\n      animeDetailStream.updateIsLoading(true, \"isLoadingInfoAnime\");\r\n      animeDetailStream.updateData({\r\n        isAddMode: null,\r\n      });\r\n    }),\r\n    mergeMapTo(\r\n      iif(\r\n        () =>\r\n          cachesStore.currentState()[name] &&\r\n          cachesStore.currentState()[name].dataInfo,\r\n        timer(0).pipe(map(() => cachesStore.currentState()[name].dataInfo)),\r\n        timer(0).pipe(\r\n          delay(1500),\r\n          mergeMapTo(\r\n            ajax(`https://api.jikan.moe/v4/${type}/${name}`).pipe(\r\n              pluck(\"response\", \"data\"),\r\n              retry(1),\r\n              switchMap((data) => {\r\n                if ([404, 500].includes(data.status)) {\r\n                  return throwError(\"404 error\");\r\n                }\r\n                return of(data);\r\n              })\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  );\r\n};\r\n\r\nexport const fetchAnimeThemes$ = (malId, type) => {\r\n  return timer(0).pipe(\r\n    mergeMapTo(\r\n      iif(\r\n        () =>\r\n          cachesStore.currentState()[malId] &&\r\n          cachesStore.currentState()[malId].themes,\r\n        timer(0).pipe(map(() => cachesStore.currentState()[malId].themes)),\r\n        timer(0).pipe(\r\n          takeWhile(() => type === \"anime\"),\r\n          switchMapTo(\r\n            ajax(`https://api.jikan.moe/v4/${type}/${malId}/themes`).pipe(\r\n              retry(6),\r\n              pluck(\"response\", \"data\")\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  );\r\n};\r\n\r\nexport const fetchAnimeExternal$ = (malId, type) => {\r\n  return timer(0).pipe(\r\n    mergeMapTo(\r\n      iif(\r\n        () =>\r\n          cachesStore.currentState()[malId] &&\r\n          cachesStore.currentState()[malId].externals,\r\n        timer(0).pipe(map(() => cachesStore.currentState()[malId].externals)),\r\n        timer(0).pipe(\r\n          delay(1500),\r\n          mergeMapTo(\r\n            ajax(`https://api.jikan.moe/v4/${type}/${malId}/external`).pipe(\r\n              retry(6),\r\n              pluck(\"response\", \"data\")\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  );\r\n};\r\n\r\nexport const fetchDataVideo$ = (malId, type) => {\r\n  return iif(\r\n    () =>\r\n      cachesStore.currentState()[malId] &&\r\n      cachesStore.currentState()[malId].dataVideoPromo,\r\n    timer(0).pipe(map(() => cachesStore.currentState()[malId].dataVideoPromo)),\r\n    timer(0).pipe(\r\n      takeWhile(() => type === \"anime\"),\r\n      tap(() => {\r\n        animeDetailStream.updateIsLoading(true, \"isLoadingVideoAnime\");\r\n      }),\r\n      delay(1500),\r\n      mergeMapTo(\r\n        ajax(`https://api.jikan.moe/v4/anime/${malId}/videos`).pipe(\r\n          retry(6),\r\n          pluck(\"response\", \"data\")\r\n        )\r\n      )\r\n    )\r\n  );\r\n};\r\n\r\nexport const fetchEpisodeDataVideo$ = (malId, type) => {\r\n  return timer(0).pipe(\r\n    takeWhile(() => type === \"anime\"),\r\n    tap(() => {\r\n      animeDetailStream.updateIsLoading(true, \"isLoadingEpisode\");\r\n    }),\r\n    mergeMapTo(ajax(`/api/movies/${malId}/episodes`).pipe(pluck(\"response\"))),\r\n    catchError(() => {\r\n      console.log(\"Don't have episodes\");\r\n      return of({ error: \"Don't have episodes\" });\r\n    })\r\n  );\r\n};\r\n\r\nexport function fetchLargePicture$(name, type) {\r\n  return timer(0).pipe(\r\n    tap(() => {\r\n      document.body.style.backgroundImage = `url(/background.jpg)`;\r\n      document.body.style.backgroundSize = \"cover\";\r\n      animeDetailStream.updateIsLoading(true, \"isLoadingLargePicture\");\r\n    }),\r\n    mergeMapTo(\r\n      iif(\r\n        () =>\r\n          cachesStore.currentState()[name] &&\r\n          cachesStore.currentState()[name].dataLargePictureList,\r\n        timer(0).pipe(\r\n          map(() => cachesStore.currentState()[name].dataLargePictureList)\r\n        ),\r\n        timer(0).pipe(\r\n          delay(1500),\r\n          mergeMapTo(\r\n            ajax(`https://api.jikan.moe/v4/${type}/${name}/pictures`).pipe(\r\n              pluck(\"response\", \"data\"),\r\n              retry(5),\r\n              map((pictures) => ({\r\n                pictures: pictures.map(\r\n                  ({ jpg, webp }) => webp.large_image_url || jpg.large_image_url\r\n                ),\r\n              }))\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\nexport const fetchBoxMovieOneMovie$ = (malId, idCartoonUser) => {\r\n  return ajax({\r\n    url: `/api/movies/box/${malId}`,\r\n    headers: {\r\n      authorization: `Bearer ${idCartoonUser}`,\r\n    },\r\n  }).pipe(\r\n    pluck(\"response\"),\r\n    catchError((error) => of({ error }))\r\n  );\r\n};\r\n\r\nexport function capitalizeString(string) {\r\n  string = string.replace(\"_\", \" \");\r\n  return capitalize(string);\r\n}\r\n\r\nexport function fetchAnimeRecommendation$(malId, type) {\r\n  return timer(0).pipe(\r\n    tap(() => {\r\n      animeDetailStream.updateIsLoading(true, \"isLoadingRelated\");\r\n    }),\r\n    delay(1500),\r\n    mergeMapTo(\r\n      ajax({\r\n        url: `https://api.jikan.moe/v4/${type}/${malId}/recommendations`,\r\n      }).pipe(\r\n        retry(6),\r\n        pluck(\"response\", \"data\"),\r\n        catchError((error) => of({ error }))\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\nexport function fetchDataCharacter$(malId, type) {\r\n  return timer(0).pipe(\r\n    tap(() => {\r\n      animeDetailStream.updateIsLoading(true, \"isLoadingCharacter\");\r\n    }),\r\n    mergeMapTo(iif(\r\n      () =>\r\n        cachesStore.currentState()[malId] &&\r\n        cachesStore.currentState()[malId].dataCharacter,\r\n      timer(0).pipe(map(() => cachesStore.currentState()[malId].dataCharacter)),\r\n      timer(0).pipe(\r\n        mergeMapTo(\r\n          ajax(`https://api.jikan.moe/v4/${type}/${malId}/characters`).pipe(\r\n            retry(20),\r\n            pluck(\"response\", \"data\"),\r\n            catchError((error) => of({ error }))\r\n          )\r\n        )\r\n      )\r\n    ))\r\n  );\r\n}\r\n\r\nexport function handleAddBoxMovie(addMovieRef, idCartoonUser, isAddMode) {\r\n  return timer(0).pipe(\r\n    debounceTime(500),\r\n    filter(() => isAddMode === true && addMovieRef.current),\r\n    switchMap(() => {\r\n      return fromEvent(addMovieRef.current, \"click\").pipe(\r\n        filter(() => animeDetailStream.currentState().dataInformationAnime),\r\n        exhaustMap(() =>\r\n          ajax({\r\n            method: \"POST\",\r\n            url: \"/api/movies/box\",\r\n            headers: {\r\n              authorization: `Bearer ${idCartoonUser}`,\r\n            },\r\n            body: {\r\n              malId:\r\n                animeDetailStream.currentState().dataInformationAnime.mal_id,\r\n              title:\r\n                animeDetailStream.currentState().dataInformationAnime.title,\r\n              imageUrl:\r\n                animeDetailStream.currentState().dataLargePictureList[0],\r\n              episodes:\r\n                animeDetailStream.currentState().dataInformationAnime\r\n                  .episodes || \"??\",\r\n              score:\r\n                animeDetailStream.currentState().dataInformationAnime.score,\r\n              airing:\r\n                animeDetailStream.currentState().dataInformationAnime.airing,\r\n              synopsis:\r\n                animeDetailStream.currentState().dataInformationAnime.synopsis,\r\n            },\r\n          }).pipe(\r\n            pluck(\"response\", \"message\"),\r\n            map((data) => ({ ...data, typeResponse: \"handle add box\" })),\r\n            catchError(() => {\r\n              animeDetailStream.updateData({\r\n                triggerFetch: !animeDetailStream.currentState().triggerFetch,\r\n              });\r\n            })\r\n          )\r\n        )\r\n      );\r\n    })\r\n  );\r\n}\r\n\r\nexport function handleDeleteBoxMovie(\r\n  deleteMovieRef,\r\n  idCartoonUser,\r\n  malId,\r\n  isAddMode\r\n) {\r\n  return timer(0).pipe(\r\n    debounceTime(500),\r\n    filter(() => isAddMode === false && deleteMovieRef.current),\r\n    switchMap(() => {\r\n      return fromEvent(deleteMovieRef.current, \"click\").pipe(\r\n        filter(() => animeDetailStream.currentState().dataInformationAnime),\r\n        exhaustMap(() =>\r\n          ajax({\r\n            method: \"DELETE\",\r\n            url: `/api/movies/box/${malId}`,\r\n            headers: {\r\n              authorization: `Bearer ${idCartoonUser}`,\r\n            },\r\n          }).pipe(\r\n            pluck(\"response\", \"message\"),\r\n            map((data) => ({ ...data, typeResponse: \"handle delete box\" })),\r\n            catchError(() => {\r\n              animeDetailStream.updateData({\r\n                triggerFetch: !animeDetailStream.currentState().triggerFetch,\r\n              });\r\n            })\r\n          )\r\n        )\r\n      );\r\n    })\r\n  );\r\n}\r\n","import { from, fromEvent, of } from \"rxjs\";\r\nimport { ajax } from \"rxjs/ajax\";\r\nimport {\r\n  catchError,\r\n  combineAll,\r\n  exhaustMap,\r\n  filter,\r\n  map,\r\n  pluck,\r\n  startWith,\r\n  switchMap,\r\n  tap,\r\n} from \"rxjs/operators\";\r\n\r\nimport theaterStore from \"../store/theater\";\r\n\r\nexport const theaterStream = theaterStore;\r\nexport const validateForm$ = (buttonSubmitElement, ...elements) => {\r\n  buttonSubmitElement.disabled = true;\r\n  return from(\r\n    elements.map((element) => {\r\n      return fromEvent(element, \"input\");\r\n    })\r\n  ).pipe(\r\n    combineAll(),\r\n    map((events) => {\r\n      let check = true;\r\n      const valueInputs = events.map((event) => {\r\n        if (event.target.value.length === 0) {\r\n          check = false;\r\n        }\r\n        return event.target.value;\r\n      });\r\n      if (check) {\r\n        buttonSubmitElement.disabled = false;\r\n      } else {\r\n        buttonSubmitElement.disabled = true;\r\n      }\r\n      return valueInputs;\r\n    })\r\n  );\r\n};\r\n\r\nexport const fetchRoomsData$ = (idCartoonUser) => {\r\n  return ajax({\r\n    url: `/api/theater`,\r\n    headers: {\r\n      authorization: `Bearer ${idCartoonUser}`,\r\n    },\r\n    method: \"GET\",\r\n  }).pipe(\r\n    pluck(\"response\", \"message\"),\r\n    catchError(() => of([]))\r\n  );\r\n};\r\n\r\nexport const submitFormPasswordRoom$ = (\r\n  inputElement,\r\n  groupId,\r\n  idCartoonUser,\r\n  setErrorPassword\r\n) => {\r\n  return fromEvent(inputElement, \"keyup\").pipe(\r\n    filter((e) => e.keyCode === 13),\r\n    tap(() => setErrorPassword(null)),\r\n    pluck(\"target\", \"value\"),\r\n    exhaustMap((password) =>\r\n      ajax({\r\n        method: \"POST\",\r\n        url: `/api/theater/${groupId}/join`,\r\n        headers: {\r\n          authorization: `Bearer ${idCartoonUser}`,\r\n        },\r\n        body: {\r\n          password: password,\r\n        },\r\n      }).pipe(\r\n        catchError((error) => {\r\n          if (error) {\r\n            setErrorPassword(error.response.error);\r\n          } else {\r\n            setErrorPassword(null);\r\n          }\r\n          return of(null);\r\n        })\r\n      )\r\n    )\r\n  );\r\n};\r\n\r\nexport const fetchUserOnline$ = (groupId, idCartoonUser) => {\r\n  return ajax({\r\n    url: `/api/theater/${groupId}/members`,\r\n    headers: {\r\n      authorization: `Bearer ${idCartoonUser}`,\r\n    },\r\n  }).pipe(\r\n    pluck(\"response\", \"message\"),\r\n    catchError(() => of([]))\r\n  );\r\n};\r\n\r\nexport const createNewMessageDialog$ = (inputElement) => {\r\n  return fromEvent(inputElement, \"keydown\").pipe(\r\n    filter((event) => event.keyCode === 13 && event.target.value !== \"\"),\r\n    pluck(\"target\", \"value\"),\r\n    tap(() => (inputElement.value = \"\"))\r\n  );\r\n};\r\n\r\nexport const createNewMessageNotSignIn$ = (user, ...elements) => {\r\n  const elementsListen = elements.map((element) => fromEvent(element, \"input\"));\r\n  elementsListen[0] = elementsListen[0].pipe(\r\n    pluck(\"target\", \"value\"),\r\n    startWith(user ? user.username : \"\")\r\n  );\r\n  elementsListen[1] = elementsListen[1].pipe(\r\n    pluck(\"target\", \"value\"),\r\n    startWith(\"\")\r\n  );\r\n  return from(elementsListen).pipe(\r\n    combineAll(),\r\n    map((texts) => {\r\n      const blankExistIndex = texts.findIndex((text) => text.trim() === \"\");\r\n      return { blankExistIndex, texts };\r\n    }),\r\n    filter(({ blankExistIndex }) => blankExistIndex < 0),\r\n    switchMap(({ texts }) =>\r\n      fromEvent(document, \"keyup\").pipe(\r\n        filter((e) => {\r\n          if (e.keyCode !== 13) {\r\n            return false;\r\n          }\r\n          const blankExistIndex = elements.findIndex(\r\n            (element) => element.value.trim() === \"\"\r\n          );\r\n          return blankExistIndex >= 0 ? false : true;\r\n        }),\r\n        map(() => texts)\r\n      )\r\n    )\r\n  );\r\n};\r\n","import { BehaviorSubject } from \"rxjs\";\r\nimport io from \"socket.io-client\";\r\nconst behaviorSubject = new BehaviorSubject();\r\nconst initialState = {\r\n  rooms: [],\r\n  allowFetchRooms: true,\r\n  currentRoomDetail: null,\r\n  isSignIn: false,\r\n  notifications: [],\r\n  roomsLoginId: [],\r\n  allowFetchCurrentRoomDetail: true,\r\n  usersOnline: [],\r\n  modeRoom: 1,\r\n  userId: null,\r\n  allowRemoveVideoWatch: true,\r\n  allowUserJoin: true,\r\n  unreadMessage: 0,\r\n  groupId: null,\r\n  timePlayingVideo: 0,\r\n  videoUrl: null,\r\n  isVideoCall: false,\r\n  isControlVideoWatching: false,\r\n  isReconnect: false,\r\n  isTriggerReconnect: false,\r\n  isVideoWatchPlaying: false,\r\n  peerId: null,\r\n  isDisableReconnectButton: false,\r\n};\r\nlet state = initialState;\r\nconst theaterStore = {\r\n  initialState,\r\n  socket: io.connect(\r\n    process.env.NODE_ENV === \"development\" ? \"localhost:5000\" : \"/\",\r\n    {\r\n      upgrade: false,\r\n      transports: [\"websocket\"],\r\n    }\r\n  ),\r\n  subscribe: (setState) => behaviorSubject.subscribe(setState),\r\n  currentState: () => {\r\n    let temp;\r\n    behaviorSubject.subscribe((v) => (temp = v));\r\n    return temp || initialState;\r\n  },\r\n  init: () => {\r\n    behaviorSubject.next(state);\r\n  },\r\n  updateData: (object = initialState) => {\r\n    state = {\r\n      ...state,\r\n      ...object,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n};\r\n\r\nexport const updateAllowFetchRooms = (bool) => {\r\n  state.allowFetchRooms = bool;\r\n};\r\n\r\nexport const updateSignIn = (bool) => {\r\n  state.isSignIn = bool;\r\n};\r\n\r\nexport const updateAllowFetchCurrentRoomDetail = (bool) => {\r\n  state.allowFetchCurrentRoomDetail = bool;\r\n};\r\n\r\nexport const updateUserIdNow = (string) => {\r\n  state.userId = string;\r\n};\r\n\r\nexport const updateAllowRemoveVideoWatch = (bool) => {\r\n  state.allowRemoveVideoWatch = bool;\r\n};\r\n\r\nexport const updateAllowUserJoin = (bool) => {\r\n  state.allowUserJoin = bool;\r\n};\r\n\r\nexport default theaterStore;\r\n","import { fromEvent, timer, of, from } from \"rxjs\";\r\nimport { ajax } from \"rxjs/ajax\";\r\nimport {\r\n  map,\r\n  switchMapTo,\r\n  catchError,\r\n  combineAll,\r\n  pluck,\r\n  startWith,\r\n} from \"rxjs/operators\";\r\n\r\nimport chatStore from \"../store/comment\";\r\n\r\nexport const chatStream = chatStore;\r\n\r\nexport const validateInput$ = (\r\n  inputElement,\r\n  inputAuthorElement,\r\n  buttonSubmitElement\r\n) => {\r\n  buttonSubmitElement.disabled = true;\r\n  const inputAuthor$ = fromEvent(inputAuthorElement, \"input\").pipe(\r\n    pluck(\"target\", \"value\"),\r\n    startWith(chatStream.currentState().currentName)\r\n  );\r\n  const input$ = fromEvent(inputElement, \"input\").pipe(\r\n    pluck(\"target\", \"innerText\"),\r\n    startWith(\"\")\r\n  );\r\n  return from([inputAuthor$, input$]).pipe(\r\n    combineAll(),\r\n    map(([inputAuthor, input]) => {\r\n      const text = input;\r\n      const textAuthor = inputAuthor;\r\n      if (text.trim() === \"\" || textAuthor.trim() === \"\") {\r\n        buttonSubmitElement.disabled = true;\r\n      } else {\r\n        buttonSubmitElement.disabled = false;\r\n      }\r\n    })\r\n  );\r\n};\r\n\r\nexport const fetchPageMessage$ = (malId) => {\r\n  return timer(0).pipe( \r\n    switchMapTo(\r\n      ajax({\r\n        url: `/api/movies/${malId}?page=`+chatStream.currentState().currentPage,\r\n      }).pipe(\r\n        map((res) => res.response.message),\r\n        catchError(() => of([]))\r\n      )\r\n    )\r\n  );\r\n};\r\n\r\nexport const timeSince = (date) => {\r\n  var seconds = Math.floor((new Date() - date) / 1000);\r\n\r\n  var interval = seconds / 31536000;\r\n\r\n  if (interval > 1) {\r\n    return Math.floor(interval) + \" years\";\r\n  }\r\n  interval = seconds / 2592000;\r\n  if (interval > 1) {\r\n    return Math.floor(interval) + \" months\";\r\n  }\r\n  interval = seconds / 86400;\r\n  if (interval > 1) {\r\n    return Math.floor(interval) + \" days\";\r\n  }\r\n  interval = seconds / 3600;\r\n  if (interval > 1) {\r\n    return Math.floor(interval) + \" hours\";\r\n  }\r\n  interval = seconds / 60;\r\n  if (interval > 1) {\r\n    return Math.floor(interval) + \" minutes\";\r\n  }\r\n  if (Math.floor(seconds) === 1) {\r\n    return Math.floor(seconds) + \" second\";\r\n  }\r\n  if (Math.floor(seconds) === 0) {\r\n    return \"Recently\";\r\n  }\r\n  return Math.floor(seconds) + \" seconds\";\r\n};\r\n","import { BehaviorSubject } from \"rxjs\";\r\n\r\nconst initialState = {\r\n  messages: [],\r\n  currentPage: 1,\r\n  numberCommentOfEachPage: 5,\r\n  indexInputDisplayBlock: null,\r\n  malId: null,\r\n  shouldFetchComment: true,\r\n  currentName: \"\",\r\n  lastPageComment: 1,\r\n  triggerFetch: 0,\r\n};\r\n\r\nconst behaviorSubject = new BehaviorSubject();\r\nlet state = initialState;\r\nconst chatStore = {\r\n  initialState,\r\n  subscribe: (setState) => behaviorSubject.subscribe((v) => setState(v)),\r\n  init: () => {\r\n    behaviorSubject.next(state);\r\n  },\r\n  updateData: (object = initialState) => {\r\n    state = {\r\n      ...state,\r\n      ...object,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  currentState: () => {\r\n    let ans;\r\n    behaviorSubject.subscribe((v) => {\r\n      ans = v;\r\n    });\r\n    return ans || initialState;\r\n  },\r\n  updateMessages: (messages, lastPage) => {\r\n    state = {\r\n      ...state,\r\n      messages: messages,\r\n      lastPageComment: lastPage,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updateCurrentPage: (page) => {\r\n    state = {\r\n      ...state,\r\n      currentPage: page,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n};\r\n\r\nexport const updateCurrentName = (name) => {\r\n  state.currentName = name;\r\n};\r\nexport default chatStore;\r\n",null,"import { BehaviorSubject } from \"rxjs\";\r\nconst initialState = {\r\n  episodes: {},\r\n  reviewsData: [],\r\n  pageReviewsData: 1,\r\n  pageReviewsOnDestroy: null,\r\n  isStopFetchingReviews: false,\r\n  shouldUpdatePageReviewData: false,\r\n  previousMalId: null,\r\n  pageSplit: 1,\r\n  title: null,\r\n  malId: null,\r\n  imageUrl: null,\r\n  switchVideo:false\r\n};\r\nconst behaviorSubject = new BehaviorSubject(initialState);\r\nlet state = initialState;\r\n\r\nconst pageWatchStore = {\r\n  initialState,\r\n  currentState: () => {\r\n    let current;\r\n    behaviorSubject.subscribe((v) => (current = v));\r\n    return current || initialState;\r\n  },\r\n  subscribe: (setState) => behaviorSubject.subscribe((v) => setState(v)),\r\n  init: () => {\r\n    behaviorSubject.next(state);\r\n  },\r\n  updateSwitchVideo:(bool)=>{\r\n    state={\r\n      ...state,\r\n      switchVideo:bool\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  updateInfoPageWatch: (malId) => {\r\n    state = {\r\n      ...state,\r\n      malId,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  resetState: () => {\r\n    state = {\r\n      ...state,\r\n      episodes: {},\r\n      malId: null,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  updateTitle: (title) => {\r\n    state = {\r\n      ...state,\r\n      title,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  updateImageUrl: (imageUrl) => {\r\n    state = {\r\n      ...state,\r\n      imageUrl,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n  updatePageSplit: (page) => {\r\n    state = {\r\n      ...state,\r\n      pageSplit: page,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updateReviewsData: (data) => {\r\n    state = {\r\n      ...state,\r\n      reviewsData: data,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  resetReviewsData: () => {\r\n    state = {\r\n      ...state,\r\n      reviewsData: [],\r\n      pageReviewsData: 1,\r\n      pageSplit: 1,\r\n      isStopFetchingReviews: false,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updatePageReviewsOnDestroy: (page) => {\r\n    state = {\r\n      ...state,\r\n      pageReviewsOnDestroy: page,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  allowUpdatePageReviewsData: (bool) => {\r\n    state = {\r\n      ...state,\r\n      shouldUpdatePageReviewData: bool,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updateIsStopFetching: (bool) => {\r\n    state = {\r\n      ...state,\r\n      isStopFetchingReviews: bool,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updatePageReview: (page) => {\r\n    state = {\r\n      ...state,\r\n      pageReviewsData: page,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updatePreviousMalId: (malId) => {\r\n    state = {\r\n      ...state,\r\n      previousMalId: malId,\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n\r\n  updateEpisodes: (data) => {\r\n    state = {\r\n      ...state,\r\n      episodes: { ...data },\r\n    };\r\n    behaviorSubject.next(state);\r\n  },\r\n};\r\n\r\nexport default pageWatchStore;\r\n","import { of, timer } from 'rxjs';\r\nimport { ajax } from 'rxjs/ajax';\r\nimport { catchError, pluck, switchMapTo } from 'rxjs/operators';\r\n\r\nimport pageWatchStore from '../store/pageWatch';\r\n\r\nexport const pageWatchStream = pageWatchStore;\r\n\r\nexport const fetchEpisodesOfMovie$ = (malId) => {\r\n  return timer(0).pipe(\r\n    switchMapTo(\r\n      ajax({\r\n        url: `/api/movies/${malId}/episodes`,\r\n      }).pipe(\r\n        pluck(\"response\", \"message\"),\r\n        catchError(() => {\r\n          return of([]);\r\n        })\r\n      )\r\n    )\r\n  );\r\n};","/* eslint-disable eqeqeq */\r\nimport \"./EpisodePage.css\";\r\n\r\nimport loadable from \"@loadable/component\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\n\r\nimport { fetchEpisodesOfMovie$, pageWatchStream } from \"../../epics/pageWatch\";\r\nimport { theaterStream } from \"../../epics/theater\";\r\nimport { userStream } from \"../../epics/user\";\r\nimport { ajax } from \"rxjs/ajax\";\r\nimport { catchError, pluck, retry } from \"rxjs/operators\";\r\nimport { of } from \"rxjs\";\r\nimport { animeDetailStream } from \"../../epics/animeDetail\";\r\nimport { chatStream } from \"../../epics/comment\";\r\nconst Comment = loadable(() => import(\"../../components/Comment/Comment\"));\r\nconst Chat = loadable(() => import(\"../../components/Chat/Chat\"), {\r\n  fallback: (\r\n    <CircularProgress\r\n      color=\"secondary\"\r\n      size=\"7rem\"\r\n      style={{ margin: \"1rem\" }}\r\n    />\r\n  ),\r\n});\r\nconst VideoPlayerSection = loadable(\r\n  () => import(\"../../components/VideoPlayerSection/VideoPlayerSection\"),\r\n  {\r\n    fallback: (\r\n      <CircularProgress\r\n        color=\"inherit\"\r\n        size=\"7rem\"\r\n        style={{ margin: \"1rem\" }}\r\n      />\r\n    ),\r\n  }\r\n);\r\n\r\nconst EpisodePage = (props) => {\r\n  const { malId, episode, mode } = props.match.params;\r\n  const history = useHistory();\r\n  const [pageWatchState, setPageWatchState] = useState(\r\n    pageWatchStream.initialState\r\n  );\r\n  const [isDisplayVietSub, setIsDisplayVietSub] = useState(false);\r\n  const [isDisplayEngSub, setIsDisplayEngSub] = useState(false);\r\n  const [isDisplayEngDub, setIsDisplayEngDub] = useState(false);\r\n\r\n  const user = userStream.currentState();\r\n  useEffect(() => {\r\n    pageWatchStream.updateSwitchVideo(false);\r\n  }, [episode, mode]);\r\n  useEffect(() => {\r\n    const subscription = pageWatchStream.subscribe(setPageWatchState);\r\n    pageWatchStream.init();\r\n    if (mode === \"Eng\") {\r\n      setIsDisplayEngSub(true);\r\n    } else if (mode === \"EngDub\") {\r\n      setIsDisplayEngDub(true);\r\n    } else {\r\n      setIsDisplayVietSub(true);\r\n    }\r\n    window.scroll({ top: 0 });\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n  useEffect(() => {\r\n    if (\r\n      pageWatchState.title &&\r\n      [\"Eng\", \"vie\", \"EngDub\"].includes(mode) &&\r\n      episode\r\n    )\r\n      document.title = `Watch ${pageWatchState.title} Episode ${episode} ${\r\n        mode === \"Eng\"\r\n          ? \"Eng Subbed\"\r\n          : mode === \"vie\"\r\n          ? \"Vie Subbed\"\r\n          : \"Eng Dubbed\"\r\n      } on MyAnimeFun`;\r\n    return () => {\r\n      document.title = `My Anime Fun - Watch latest anime in high quality`;\r\n    };\r\n  }, [episode, malId, pageWatchState.title, mode]);\r\n  useEffect(() => {\r\n    if (pageWatchStream.currentState().malId !== malId) {\r\n      pageWatchStream.resetState();\r\n      chatStream.updateData({\r\n        messages: [],\r\n        currentPage: 1,\r\n        lastPageComment: 1,\r\n      });\r\n    }\r\n  }, [malId]);\r\n  useEffect(() => {\r\n    if (user)\r\n      theaterStream.socket.emit(\"user-join-watch\", malId, user.username);\r\n    let fetchEpisodesSub, fetchTitleAnimeSub;\r\n    if (\r\n      animeDetailStream.currentState().malId === malId &&\r\n      !!animeDetailStream.currentState().dataLargePicture\r\n    ) {\r\n      pageWatchStream.updateEpisodes(\r\n        animeDetailStream.currentState().dataEpisodesAnime\r\n      );\r\n      pageWatchStream.updateTitle(\r\n        animeDetailStream.currentState().dataInformationAnime.title\r\n      );\r\n      pageWatchStream.updateImageUrl(\r\n        animeDetailStream.currentState().dataLargePicture\r\n      );\r\n      pageWatchStream.updateInfoPageWatch(malId);\r\n    } else {\r\n      fetchEpisodesSub = fetchEpisodesOfMovie$(malId).subscribe((v) => {\r\n        pageWatchStream.updateEpisodes(v);\r\n        pageWatchStream.updateInfoPageWatch(malId);\r\n      });\r\n      fetchTitleAnimeSub = fetchTitle$(malId).subscribe((v) => {\r\n        pageWatchStream.updateTitle(v.title);\r\n        pageWatchStream.updateImageUrl(v.images.webp.image_url);\r\n      });\r\n    }\r\n    return () => {\r\n      fetchTitleAnimeSub && fetchTitleAnimeSub.unsubscribe();\r\n      fetchEpisodesSub && fetchEpisodesSub.unsubscribe();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [malId]);\r\n  let currentEpisode = {};\r\n  let episodes = [];\r\n  if (mode === \"vie\") {\r\n    episodes = pageWatchState.episodes.episodes;\r\n  } else if (mode === \"Eng\") {\r\n    episodes = pageWatchState.episodes.episodesEng;\r\n  } else if (mode === \"EngDub\") {\r\n    episodes = pageWatchState.episodes.episodesEngDub;\r\n  }\r\n  if (episodes)\r\n    currentEpisode = episodes.find((ep) => {\r\n      ep.episode = parseFloat(ep.episode);\r\n      return ep.episode == episode;\r\n    });\r\n  let episodeIndex = 0;\r\n  if (episodes)\r\n    episodeIndex = episodes.findIndex((data) => data.episode == episode);\r\n  return (\r\n    <div className=\"container-episode-movie\">\r\n      <div\r\n        className=\"button-go-back\"\r\n        onClick={() => {\r\n          history.push(\"/anime/\" + malId);\r\n        }}\r\n      >\r\n        <i className=\"fas fa-arrow-left\"></i>\r\n      </div>\r\n      {pageWatchState.title &&\r\n        [\"Eng\", \"vie\", \"EngDub\"].includes(mode) &&\r\n        episode && (\r\n          <h1 className=\"episode-page__title\">\r\n            <div className=\"title-anime\">{pageWatchState.title}</div>\r\n            <div className=\"episode-sub-detail\">\r\n              Episode {episode} {\"- \"}\r\n              {mode === \"Eng\"\r\n                ? \"English Subbed\"\r\n                : mode === \"vie\"\r\n                ? \"Vietnamese Subbed\"\r\n                : \"English Dubbed\"}\r\n            </div>\r\n          </h1>\r\n        )}\r\n      <div className=\"wrapper-player-video\">\r\n        <div className=\"wrapper-discuss-section\">\r\n          <h1>CHAT</h1>\r\n          <Chat groupId={malId} user={user} />\r\n        </div>\r\n        <VideoPlayerSection currentEpisode={currentEpisode} user={user} />\r\n      </div>\r\n      <div className=\"next-previous-episode-container\">\r\n        {episodeIndex - 1 > -1 && (\r\n          <div\r\n            className=\"previous-episode\"\r\n            onClick={() => {\r\n              history.push(\r\n                `/anime/${malId}/watch/${\r\n                  episodes[episodeIndex - 1].episode\r\n                }/${mode}`\r\n              );\r\n            }}\r\n          >\r\n            <i className=\"fas fa-chevron-left\"></i>\r\n            <i className=\"fas fa-chevron-left\"></i> Watch episode{\" \"}\r\n            {episodes[episodeIndex - 1].episode}\r\n          </div>\r\n        )}\r\n        {mode === \"Eng\" &&\r\n          pageWatchState.episodes &&\r\n          pageWatchState.episodes.episodesEng &&\r\n          episodeIndex + 1 < pageWatchState.episodes.episodesEng.length && (\r\n            <div\r\n              className=\"next-episode\"\r\n              onClick={() => {\r\n                history.push(\r\n                  `/anime/${malId}/watch/${\r\n                    episodes[episodeIndex + 1].episode\r\n                  }/${mode}`\r\n                );\r\n              }}\r\n            >\r\n              Watch episode {episodes[episodeIndex + 1].episode}{\" \"}\r\n              <i className=\"fas fa-chevron-right\"></i>\r\n              <i className=\"fas fa-chevron-right\"></i>\r\n            </div>\r\n          )}\r\n        {mode === \"vie\" &&\r\n          pageWatchState.episodes &&\r\n          pageWatchState.episodes.episodes &&\r\n          episodeIndex + 1 < pageWatchState.episodes.episodes.length && (\r\n            <div\r\n              className=\"next-episode\"\r\n              onClick={() => {\r\n                history.push(\r\n                  `/anime/${malId}/watch/${\r\n                    episodes[episodeIndex + 1].episode\r\n                  }/${mode}`\r\n                );\r\n              }}\r\n            >\r\n              Watch episode {episodes[episodeIndex + 1].episode}{\" \"}\r\n              <i className=\"fas fa-chevron-right\"></i>\r\n              <i className=\"fas fa-chevron-right\"></i>\r\n            </div>\r\n          )}\r\n        {mode === \"EngDub\" &&\r\n          pageWatchState.episodes &&\r\n          pageWatchState.episodes.episodesEngDub &&\r\n          episodeIndex + 1 < pageWatchState.episodes.episodesEngDub.length && (\r\n            <div\r\n              className=\"next-episode\"\r\n              onClick={() => {\r\n                history.push(\r\n                  `/anime/${malId}/watch/${\r\n                    episodes[episodeIndex + 1].episode\r\n                  }/${mode}`\r\n                );\r\n              }}\r\n            >\r\n              Watch episode {episodes[episodeIndex + 1].episode}{\" \"}\r\n              <i className=\"fas fa-chevron-right\"></i>\r\n              <i className=\"fas fa-chevron-right\"></i>\r\n            </div>\r\n          )}\r\n      </div>\r\n      <div className=\"section-episodes-display\">\r\n        {pageWatchState.episodes &&\r\n          pageWatchState.episodes.episodes &&\r\n          pageWatchState.episodes.episodes.length > 0 && (\r\n            <div\r\n              className=\"container-episode-display\"\r\n              style={{ maxHeight: isDisplayVietSub ? \"100%\" : \"100px\" }}\r\n            >\r\n              <h1\r\n                className={`title${isDisplayVietSub ? \" title-active\" : \"\"}`}\r\n                onClick={() => setIsDisplayVietSub(!isDisplayVietSub)}\r\n              >\r\n                Vietsub\r\n              </h1>\r\n              <ListEpisodeUrlDisplay\r\n                episodes={\r\n                  mode === \"vie\" ? episodes : pageWatchState.episodes.episodes\r\n                }\r\n                episode={episode}\r\n                malId={malId}\r\n                mode={mode}\r\n                modeDisplay={\"vie\"}\r\n              />\r\n            </div>\r\n          )}\r\n        {pageWatchState.episodes &&\r\n          pageWatchState.episodes.episodesEng &&\r\n          pageWatchState.episodes.episodesEng.length > 0 && (\r\n            <div\r\n              className=\"container-episode-display\"\r\n              style={{ maxHeight: isDisplayEngSub ? \"100%\" : \"100px\" }}\r\n            >\r\n              <h1\r\n                className={`title${isDisplayEngSub ? \" title-active\" : \"\"}`}\r\n                onClick={() => setIsDisplayEngSub(!isDisplayEngSub)}\r\n              >\r\n                Engsub\r\n              </h1>\r\n              <ListEpisodeUrlDisplay\r\n                episodes={\r\n                  mode === \"Eng\"\r\n                    ? episodes\r\n                    : pageWatchState.episodes.episodesEng\r\n                }\r\n                episode={episode}\r\n                malId={malId}\r\n                mode={mode}\r\n                modeDisplay={\"Eng\"}\r\n              />\r\n            </div>\r\n          )}\r\n        {pageWatchState.episodes &&\r\n          pageWatchState.episodes.episodesEngDub &&\r\n          pageWatchState.episodes.episodesEngDub.length > 0 && (\r\n            <div\r\n              className=\"container-episode-display\"\r\n              style={{ maxHeight: isDisplayEngDub ? \"100%\" : \"100px\" }}\r\n            >\r\n              <h1\r\n                className={`title${isDisplayEngDub ? \" title-active\" : \"\"}`}\r\n                onClick={() => setIsDisplayEngDub(!isDisplayEngDub)}\r\n              >\r\n                Engdub\r\n              </h1>\r\n              <ListEpisodeUrlDisplay\r\n                episodes={\r\n                  mode === \"EngDub\"\r\n                    ? episodes\r\n                    : pageWatchState.episodes.episodesEngDub\r\n                }\r\n                episode={episode}\r\n                malId={malId}\r\n                mode={mode}\r\n                modeDisplay={\"EngDub\"}\r\n              />\r\n            </div>\r\n          )}\r\n      </div>\r\n      <Comment malId={malId} user={user} />\r\n    </div>\r\n  );\r\n};\r\nfunction ListEpisodeUrlDisplay({\r\n  episodes,\r\n  episode,\r\n  malId,\r\n  mode,\r\n  modeDisplay,\r\n}) {\r\n  return (\r\n    <div className=\"list-episode-movie\">\r\n      {episodes &&\r\n        episodes.map((ep, index) => {\r\n          return (\r\n            <Link\r\n              className={`episode-link-movie${\r\n                ep.episode == episode && mode === modeDisplay\r\n                  ? \" active-episode\"\r\n                  : \"\"\r\n              }`}\r\n              to={`/anime/${malId}/watch/${ep.episode}/${modeDisplay}`}\r\n              key={index}\r\n            >\r\n              {ep.episode}\r\n            </Link>\r\n          );\r\n        })}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction fetchTitle$(malId) {\r\n  return ajax(\"https://api.jikan.moe/v4/anime/\" + malId).pipe(\r\n    retry(10),\r\n    pluck(\"response\",\"data\"),\r\n    catchError((error) => of({ error }))\r\n  );\r\n}\r\nexport default EpisodePage;\r\n"],"sourceRoot":""}